; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html




; =================================================================
; PlatformIO Configuration File for ESP32-S3 with JTAG Debugging
; =================================================================

; This file configures your project for use with PlatformIO.
; It's set up to enable JTAG debugging on ESP32-S3 boards
; that have a native USB port for this purpose.

[env:systemsesp32s3_debug]
; -----------------------------------------------------------------
; General Project Settings
; -----------------------------------------------------------------

; Specifies the platform to use. Using a recent version of the
; espressif32 platform ensures proper support for 'esp-builtin' debug.
; Version `6.12.0` is a good, stable choice.
platform = espressif32@6.12.0

debug_extra_cmds = source [find target/freertos.cfg]
; Defines the specific development board. This should be
; changed to match your board. 'esp32-s3-devkitc-1' is a
; common and well-supported development board.
board = esp32-s3-devkitc-1

; Sets the programming framework. 
framework = espidf

; This setting makes 'debug' the default build mode. This is crucial
; for debugging as it adds debug symbols and disables compiler
; optimizations that might make it difficult to step through code.
build_type = debug

; -----------------------------------------------------------------
; Monitor and Upload Settings
; -----------------------------------------------------------------

; The baud rate for the serial monitor. This should match the
; baud rate set in your Arduino sketch's Serial.begin() call.
monitor_speed = 115200

; The upload protocol. For **native USB JTAG**, the correct protocol is
; `esptool` because it handles flashing over the USB/Serial connection.
upload_protocol = esptool



; -----------------------------------------------------------------
; Debugging Configuration
; -----------------------------------------------------------------

; The core setting to enable built-in JTAG debugging.
; 'esp-builtin' tells PlatformIO to use the native USB Serial/JTAG
; controller on the ESP32-S3 chip. This eliminates the need for
; an external debugger.
debug_tool = esp-builtin

; This setting tells the debugger to automatically set a temporary
; breakpoint at the start of the 'setup()' function. This is a great
; way to ensure the debugger connects and stops at a known point
; in your code, allowing you to begin stepping through it immediately.
debug_init_break = tbreak app_main

; This is a new line to force PlatformIO to use a specific,
; known-good version of the OpenOCD tool. This is a robust way
; to fix potential issues with toolchain conflicts or
; outdated OpenOCD versions that do not support 'esp-usb-jtag'.
platform_packages = tool-openocd-esp32@~2.1100.0

; Other optional debug settings can be added here.
; debug_port = COMx  ; (for Windows)
; debug_port = /dev/ttyACM0 ; (for Linux/macOS)


